<!DOCTYPE html>
<body>
  <p>
    Click this button to compile, run, and extract the quine!
  </p>
  <button>Click me</button>
  <p>
    Compiled <span id="count">0 times</span>.<br>
    Here's the data:<br>
    <pre></pre>
  </p>
  <script>
    let $ = document.querySelector.bind(document);
    let data = new Uint8Array([
      0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x04, 0x01, 0x60,
      0x00, 0x00, 0x03, 0x02, 0x01, 0x00, 0x05, 0x03, 0x01, 0x00, 0x01, 0x07,
      0x04, 0x01, 0x00, 0x02, 0x00, 0x08, 0x01, 0x00, 0x0a, 0x20, 0x01, 0x1e,
      0x01, 0x01, 0x7f, 0x03, 0x40, 0x20, 0x00, 0x20, 0x00, 0x28, 0x02, 0x00,
      0x36, 0x02, 0x4a, 0x20, 0x00, 0x41, 0x04, 0x6a, 0x22, 0x00, 0x41, 0xca,
      0x00, 0x49, 0x0d, 0x00, 0x0b, 0x0b, 0x0b, 0x50, 0x01, 0x00, 0x41, 0x00,
      0x0b, 0x4a,

      0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00, 0x01, 0x04, 0x01, 0x60,
      0x00, 0x00, 0x03, 0x02, 0x01, 0x00, 0x05, 0x03, 0x01, 0x00, 0x01, 0x07,
      0x04, 0x01, 0x00, 0x02, 0x00, 0x08, 0x01, 0x00, 0x0a, 0x20, 0x01, 0x1e,
      0x01, 0x01, 0x7f, 0x03, 0x40, 0x20, 0x00, 0x20, 0x00, 0x28, 0x02, 0x00,
      0x36, 0x02, 0x4a, 0x20, 0x00, 0x41, 0x04, 0x6a, 0x22, 0x00, 0x41, 0xca,
      0x00, 0x49, 0x0d, 0x00, 0x0b, 0x0b, 0x0b, 0x50, 0x01, 0x00, 0x41, 0x00,
      0x0b, 0x4a
    ]);
    const length = data.length;

    let count = 0;

    function update() {
      const row = 16;
      let s = '';
      let left = data;
      do {
        for (let x of left.slice(0, 16)) {
          s += `${x.toString(16).padStart(2, '0')} `;
        }
        s += '\n';
        left = left.slice(16);
      } while(left.length);

      $('pre').textContent = s;
      $('#count').textContent = `${count} time${count == 1 ? '' : 's'}`;
    }

    update();

    $('button').addEventListener('click', event => {
      let instance = new WebAssembly.Instance(new WebAssembly.Module(data));
      let memory = instance.exports[''];
      data = new Uint8Array(memory.buffer, 0, length);
      count++;
      update();
    });
  </script>
</body>
